\documentclass{article}
\usepackage[margin=0.5in]{geometry}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{bussproofs}
\usepackage{mathtools}

\EnableBpAbbreviations

% Misc
\newcommand{\Label}[1]{\RightLabel{\scriptsize{(\textsc{#1})}}}

% Relations
\newcommand{\REvalsTo}[2]{#1\leadsto#2}
\newcommand{\RHasType}[2]{#1:#2}
\newcommand{\RKind}[1]{\mathtt{isKind}(#1)}
\newcommand{\RTypeLike}[1]{\mathtt{isTypeLike}(#1)}

% Terms
\newcommand{\StahlDef}[3]{\mathtt{def}\,\StahlName{#1}:#2\,\texttt{=}\,#3}
\newcommand{\StahlDefEff}[3]{\mathtt{defeff}\,\StahlName{#1}:\StahlEFFECT{#2}{#3}}
\newcommand{\StahlDefEffNoReturn}[2]{\mathtt{defeff}\,\StahlName{#1}:\StahlEFFECTNoReturn{#2}}
\newcommand{\StahlEFFECT}[2]{\mathtt{EFFECT}(#1, #2)}
\newcommand{\StahlEFFECTNoReturn}[1]{\mathtt{EFFECT}(#1, -)}
\newcommand{\StahlTYPE}{\mathtt{*}}
\newcommand{\StahlName}[1]{\mathit{#1}}
\newcommand{\StahlApp}[2]{\left(#1\;#2\right)}
\newcommand{\StahlHandle}[3]{\texttt{handle}(#1,#2)\,\texttt{in}\,#3}
\newcommand{\StahlLambda}[2]{\left(\lambda\StahlName{#1}.#2\right)}
\newcommand{\StahlLet}[3]{\texttt{let}\,\StahlName{#1}\,\texttt{=}\,#2\,\texttt{in}\,#3}
\newcommand{\StahlPerform}[2]{\texttt{perform}(#1, #2)}
\newcommand{\StahlPi}[3]{\left(\Pi\StahlName{#1}:#2.#3\right)}

% BNF-making commands
\newcommand{\DefineTerm}[2]{\StahlName{#1}\Coloneqq&\ #2\\}
\newcommand{\Case}[1]{\lvert\ &\ #1\\}

\begin{document}
\section{Static Semantics}
\subsection{Terms}
\begin{align*}
	\DefineTerm{decl}{\StahlDef{x}{\StahlName{\tau}}{\StahlName{e}}}
		\Case{\StahlDefEffNoReturn{x}{\StahlName{\tau}}}
		\Case{\StahlDefEff{x}{\StahlName{\tau}}{\StahlName{\tau'}}}
		\Case{\mathtt{TODO,defty}}
	\DefineTerm{e, \tau}{\StahlName{x}}
		\Case{\StahlApp{\StahlName{e_1}}{\StahlName{e_2}}}
		\Case{\StahlHandle{\StahlName{e_1}}{\StahlName{e_2}}{\StahlName{e_3}}}
		\Case{\StahlLambda{x}{\StahlName{e}}}
		\Case{\StahlLet{x}{\StahlName{e_1}}{\StahlName{e_2}}}
		\Case{\StahlPerform{\StahlName{e_1}}{\StahlName{e_2}}}
		\Case{\StahlPi{x}{\StahlName{\tau_1}}{\StahlName{\tau_2}}}
		\Case{\StahlEFFECT{\StahlName{\tau_1}}{\StahlName{\tau_2}}}
		\Case{\StahlEFFECTNoReturn{\StahlName{\tau}}}
		\Case{\StahlTYPE}
\end{align*}

\subsection{Typing}

\begin{prooftree}
	\AXC{$\Gamma(\StahlName{x}) = \StahlName{\tau}$}
	\Label{Ty-Var}
	\UIC{$\Gamma\vdash \RHasType{\StahlName{x}}{\StahlName{\tau}}$}
\end{prooftree}

\begin{prooftree}
	\AXC{$\Gamma,\StahlName{x}:\StahlName{\tau}\vdash \RHasType{\StahlName{e}}{\StahlName{\tau'}}$}
	\Label{Ty-Lam}
	\UIC{$\Gamma\vdash \RHasType{\StahlLambda{x}{\StahlName{e}}}{\StahlPi{x}{\StahlName{\tau}}{\StahlName{\tau'}}}$}
\end{prooftree}

\begin{prooftree}
	\AXC{$\Gamma\vdash \RHasType{\StahlName{e}}{\StahlPi{x}{\StahlName{\tau}}{\StahlName{\tau'}}}$}
	\AXC{$\Gamma\vdash \RHasType{\StahlName{e'}}{\StahlName{\tau}}$}
	\AXC{$\Gamma\vdash \REvalsTo{[\StahlName{x}\rightarrow \StahlName{e'}]\StahlName{\tau'}}{\StahlName{\tau''}}$}
	\Label{Ty-App}
	\TIC{$\Gamma\vdash \RHasType{\StahlApp{\StahlName{e}}{\StahlName{e'}}}{\StahlName{\tau''}}$}
\end{prooftree}

\begin{prooftree}
	\AXC{$\Gamma\vdash \RTypeLike{\StahlName{\tau}}$}
	\AXC{$\Gamma\vdash \RTypeLike{\StahlName{\tau'}}$}
	\Label{Ty-Pi}
	\BIC{$\Gamma\vdash \RHasType{\StahlPi{x}{\StahlName{\tau}}{\StahlName{\tau'}}}{\StahlTYPE}$}
\end{prooftree}

\begin{prooftree}
	\AXC{}
	\Label{Kind-Type}
	\UIC{$\Gamma\vdash \RKind{\StahlTYPE}$}
\end{prooftree}

\begin{prooftree}
	\AXC{$\Gamma\vdash \RHasType{\StahlName{e}}{\StahlTYPE}$}
	\Label{Kind-EffNoRet}
	\UIC{$\Gamma\vdash \RKind{\StahlEFFECTNoReturn{\StahlName{e}}}$}
\end{prooftree}

\begin{prooftree}
	\AXC{$\Gamma\vdash \RHasType{\StahlName{e}}{\StahlTYPE}$}
	\AXC{$\Gamma\vdash \RHasType{\StahlName{e'}}{\StahlTYPE}$}
	\Label{Kind-Eff}
	\BIC{$\Gamma\vdash \RKind{\StahlEFFECT{\StahlName{e}}{\StahlName{e'}}}$}
\end{prooftree}

\begin{prooftree}
	\AXC{}
	\Label{TypeLike-IsType}
	\UIC{$\Gamma\vdash \RTypeLike{\StahlTYPE}$}
\end{prooftree}

\begin{prooftree}
	\AXC{$\Gamma\vdash \RHasType{\StahlName{e}}{\StahlTYPE}$}
	\Label{TypeLike-OfType}
	\UIC{$\Gamma\vdash \RTypeLike{\StahlName{e}}$}
\end{prooftree}

\section{Dynamic Semantics}

\end{document}
